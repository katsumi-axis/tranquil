# Tranquil 開発ガイド

このドキュメントは、ClaudeがTranquil SQLリンター・フォーマッターの開発とメンテナンスを行うための指示書です。

## プロジェクト概要

TranquilはTypeScriptベースのツールで、SQLのリンティングとフォーマッティングを統合したソリューションです。高速で拡張可能、使いやすいSQLコード品質改善ツールの提供を目指します。

## アーキテクチャ

```
tranquil/
├── src/
│   ├── cli/           # CLIインターフェース
│   ├── core/          # コアのリンティング・フォーマッティングロジック
│   ├── parser/        # SQLパーサー
│   ├── rules/         # リンティングルール
│   ├── formatter/     # フォーマッティングロジック
│   ├── config/        # 設定処理
│   └── index.ts       # メインエントリーポイント
├── tests/             # テストファイル
├── docs/              # ドキュメント
└── examples/          # サンプルSQLファイル
```

## 開発コマンド

```bash
# 依存関係のインストール
npm install

# プロジェクトのビルド
npm run build

# テストの実行
npm test

# リンターの実行
npm run lint

# 型チェックの実行
npm run typecheck

# 開発モード（ウォッチモード）
npm run dev
```

## 主要コンポーネント

### 1. SQLパーサー
- 既存のSQLパーサーライブラリ（例：`node-sql-parser`）を使用
- 複数のSQL方言をサポート（PostgreSQL、MySQL、SQLite、BigQuery）
- 解析用のASTを生成

### 2. リンティングエンジン
- ルールベースのアーキテクチャ
- 各ルールは独立したモジュール
- カスタムルールのサポート
- 設定可能な重要度レベル

### 3. フォーマッター
- ASTベースのフォーマッティング
- 設定可能なスタイルオプション
- コメントと空白を適切に保持

### 4. CLIインターフェース
- Commander.jsを使用したCLIパース
- globパターンのサポート
- 大きなファイル用のプログレスインジケーター
- 読みやすさのためのカラー出力

## 実装の優先順位

1. **基本的なSQL解析** - 動作するパーサーの統合
2. **コアリンティングルール** - 必須ルールの実装（構文、スタイル）
3. **基本的なフォーマッター** - シンプルなフォーマッティング機能
4. **CLIインターフェース** - コマンドラインでの使いやすさ
5. **設定システム** - カスタマイズの許可
6. **高度な機能** - 追加ルール、方言など

## テスト戦略

- 個別ルールのユニットテスト
- CLIの統合テスト
- フォーマッター出力のスナップショットテスト
- パフォーマンスベンチマーク

## 検討すべき依存関係

- `node-sql-parser` - SQL解析
- `commander` - CLIフレームワーク
- `chalk` - ターミナルカラー
- `glob` - ファイルパターンマッチング
- `jest` - テストフレームワーク

## コードスタイル

- TypeScript strictモードを使用
- 適切な場所での関数型プログラミング
- 明確なエラーメッセージ
- 包括的な型定義
- 公開APIの適切なドキュメント

## 注意事項

- BigQueryサポートは重要な機能の一つ
- エラーメッセージは日本語と英語の両方をサポートすることを検討
- パフォーマンスを重視した実装
